# Maven Notes

### Archetype
A Maven archetype is a project templating toolkit. There are many community archetypes as well as a
few official archetypes from Maven, including web app and J2EE archetypes.

### Phase
Maven is based around the concept of a build lifecycle. There are three built-in lifecycles:
`default`, `clean`, and `site`. Each lifecycle is made up of phases.

### Goal
Each build phase is made up of goals. When you run a phase, Maven will execute all goals from the
all phases leading up to the specified phase.

For example, if you run the package phase, Maven will also run the compile and test phases (and all
of their goals as well).

You can also manually define specific plugins goals to execute in the POM.

### Generate a Maven Project
 - `mvn` - the Maven binary
 - `archetype:generate` - the goal
 - `-B` - batch mode
 - `-D` - definition

```bash
mvn archetype:generate -B -DgroupId=io.github.adamelliotfields -DartifactId=project-name
```

You can also run Interactive Mode to be prompted for the definition values:

```bash
mvn archetype:generate -DinteractiveMode=true
```

### Project Structure
Project resources go in the `src/main/resources` and `src/test/resources` folders.

Compiled output goes in the `root/target` folder.

```bash
root
├── src
│   ├── main
│   │   └── java
|   |       └── io
|   |           └── github
|   |               └── adamelliotfields
|   |                   └── App.java
│   └── test
│       └── java
|           └── io
|               └── github
|                   └── adamelliotfields
|                       └── AppTest.java
└── pom.xml
```

### Project Object Model (POM)
The POM is an XML file that contains information about the project and configuration details used by
Maven to build the project.

The following POM was generated by the `maven-archetype-quickstart` archetype.

```xml
<project
  xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
>
  <modelVersion>4.0.0</modelVersion>

  <groupId>io.github.adamelliotfields</groupId>
  <artifactId>project-name</artifactId>
  <version>1.0.0</version>
  <packaging>jar</packaging>

  <name>Project Name</name>
  <url>http://maven.apache.org</url>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
  </properties>

  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>3.8.1</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
</project>
```

### Dependencies
For each external dependency, you need to define at least four items:
 - `groupId` - the package reverse domain name
 - `artifactId` - the name of the jar (without version number)
 - `version` - the version number
 - `scope` - the default scope is `compile` if none is specified

```xml
<dependency>
  <groupId>org.projectlombok</groupId>
  <artifactId>lombok</artifactId>
  <version>1.16.18</version>
  <scope>compile</scope>
</dependency>
```

### Properties
Maven properties can be default plugin values, or value placeholders accessed using `${}` notation.

To set the compiler version and encoding, add the following to your POM:

```xml
<properties>
  <maven.compiler.source>1.8</maven.compiler.source>
  <maven.compiler.target>1.8</maven.compiler.target>
  <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
  <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
</properties>
```

### Testing
By default, Maven uses Surefire to run JUnit test fixtures in the `src/test/java` directory.

To skip tests, add the following to your POM:

```xml
<properties>
  <skipTests>true</skipTests>
</properties>
```

### Cleaning
The `clean` lifecycle will remove any previously generated build files. Normally, Maven only
updates the previously built files and will leave any unchanged files and folders. Cleaning will
remove the `target` folder and give you a clean slate.

### Compiling
The `compile` phase will compile your Java files to `.class` files and output to the target
directory.

### Packaging
The `package` phase will compile your Java files and archive them in a JAR file in your target
directory. Note that this JAR is not a standalone and requires any dependencies to be in your Maven
repository (`~/.m2` by default).

### Building Executable Jar
To build a standalone, executable JAR will all dependencies included, use the Maven Shade Plugin.

This will be executed in the `package` phase.

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.apache.maven.plugins</groupId>
      <artifactId>maven-shade-plugin</artifactId>
      <version>3.1.0</version>
      <executions>
        <execution>
          <phase>package</phase>
          <goals>
            <goal>shade</goal>
          </goals>
          <configuration>
            <transformers>
              <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                <mainClass>io.github.adamelliotfields.App</mainClass>
              </transformer>
            </transformers>
          </configuration>
        </execution>
      </executions>
    </plugin>
  </plugins>
</build>
```

### Maven Wrapper
The Maven Wrapper Plugin allows you to bundle a standalone Maven binary with your source code so
collaborators can use Maven without having to install it themselves. This is especially useful if
you want all collaborators to be using the same version of Maven.

To add the wrapper to your project, run the following command within your project folder. The `-N`
flag is an alias for `non-recursive`, which tells Maven not to recurse into any sub-projects within
your project directory.

```bash
mvn -N io.takari:maven:wrapper
```

This will add a `.mvn` folder as well as `mvnw` and `mvnw.cmd` binaries.
